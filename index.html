<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,viewport-fit=cover" />
<title>BOND HEAVY DUTY ‚Äî —Å–∏–ª–æ–≤—ã–µ –¥–Ω–∏ (PWA)</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0f1216">

<style>
  /* ===== –ë–ê–ó–ê / iOS SAFE AREAS ===== */
  :root{
    --bg:#0f1216;--panel:#161a20;--ink:#e8edf3;--muted:#9aa7b3;
    --accent:#2dd4bf;--accent2:#60a5fa;--ok:#22c55e;--warn:#f59e0b;--danger:#ef4444;--line:#263242;
    --s-top: env(safe-area-inset-top);--s-right: env(safe-area-inset-right);
    --s-bottom: env(safe-area-inset-bottom);--s-left: env(safe-area-inset-left);
  }
  *{box-sizing:border-box}
  html{height:100%;-webkit-text-size-adjust:100%}
  body{
    min-height:100dvh; margin:0; overflow-x:hidden;
    background:linear-gradient(180deg,#0d1117,#0f1319 45%,#10151b);
    color:var(--ink); font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;
    padding-left:var(--s-left); padding-right:var(--s-right);
  }

  /* ===== –®–ê–ü–ö–ê ===== */
  header.topbar{
    position:sticky; top:0; z-index:10;
    background:rgba(15,18,22,.92); backdrop-filter:saturate(140%) blur(8px);
    border-bottom:1px solid var(--line); padding-top:var(--s-top);
  }
  .wrap{max-width:1100px;margin:0 auto;padding:14px 18px}
  h1{font-size:22px;margin:0 0 6px 0}
  .sub{color:var(--muted);font-size:14px}
  .toolbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:12px}
  .toolbar > *{
    background:var(--panel);border:1px solid var(--line);color:var(--ink);
    padding:10px 12px;border-radius:12px;min-height:44px
  }
  input[type="date"]{background:transparent;border:none;color:var(--ink);font-size:16px}
  .btn{cursor:pointer;user-select:none;touch-action:manipulation}
  .btn:hover{border-color:var(--accent2)}
  .btn.ok{border-color:var(--ok);color:#d1fae5}
  .btn.warn{border-color:var(--warn);color:#fff7ed}
  .btn.danger{border-color:var(--danger);color:#fee2e2}
  .btn.ghost{background:transparent}

  /* ===== –¢–ê–ë–´ ===== */
  .tabs{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}
  .tab{
    padding:10px 14px;border-radius:999px;border:1px solid var(--line);
    background:var(--panel);cursor:pointer;color:var(--ink);min-height:40px
  }
  .tab.active{border-color:var(--accent);box-shadow:0 0 0 2px rgba(45,212,191,.12) inset}

  /* ===== –ö–û–ù–¢–ï–ù–¢ ===== */
  main{max-width:1100px;margin:14px auto;padding:0 18px}
  .day{display:none}.day.active{display:block}

  .block{background:var(--panel);border:1px solid var(--line);border-radius:16px;margin:18px 0;overflow:hidden}
  .block > header{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;background:#12161c;border-bottom:1px solid var(--line)}
  .muted{color:var(--muted)}
  .tag{font-size:12px;padding:2px 8px;border-radius:999px;border:1px solid var(--line);color:#cfe9ff;background:#0d1726}
  .oktag{border-color:var(--ok);background:#0d1a13;color:#bff7cf}

  .exercises{padding:10px}
  .panel{border:1px dashed var(--line);border-radius:14px;padding:10px;margin:10px 0;background:#0f141b}
  .ex-title{font-weight:700;margin:0 0 10px 0;display:flex;align-items:center;gap:8px;flex-wrap:wrap}
  .ex-title small{color:var(--muted);font-weight:500}

  /* ===== –ì–†–ò–î–´ –°–ï–¢–û–í ===== */
  .legend, .set-row{
    display:grid; align-items:center; gap:8px;
    grid-template-columns:
      auto
      clamp(76px, 18vw, 110px)
      clamp(76px, 18vw, 110px)
      clamp(36px, 8vw, 48px);
  }
  .legend{
    color:#c9d4df; text-transform:uppercase; font-size:13px; letter-spacing:.6px;
    border-bottom:1px solid var(--line); padding:0 6px 8px 6px; margin-bottom:8px;
  }
  .legend > div:nth-child(1){opacity:.85}
  .set-row{padding:8px 6px;border-bottom:1px solid var(--line)}
  .set-row:last-child{border-bottom:none}

  .set-name{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  input[type="number"], input[type="text"]{
    width:100%;background:#0e1319;border:1px solid var(--line);color:var(--ink);
    padding:10px;border-radius:10px;outline:none;font-size:16px
  }
  input[type="number"]::-webkit-outer-spin-button,
  input[type="number"]::-webkit-inner-spin-button{ -webkit-appearance:none;margin:0 }
  .setchk{display:flex;align-items:center;justify-content:center}
  .setchk input[type="checkbox"]{width:22px;height:22px}

  @media (max-width:380px){
    .legend, .set-row{
      grid-template-columns:
        auto
        clamp(70px, 22vw, 96px)
        clamp(70px, 22vw, 96px)
        clamp(32px, 10vw, 42px);
    }
  }

  .sumline{display:flex;gap:16px;flex-wrap:wrap;align-items:center;color:var(--muted);padding:12px 14px;border-top:1px dashed var(--line)}
  footer{margin:14px 0 10px calc(18px + var(--s-left));color:var(--muted)}

  /* ===== –ú–û–î–ê–õ–ö–ê –ê–ù–ê–õ–ò–¢–ò–ö–ò ===== */
  .modal{
    position:fixed; inset:0; background:rgba(0,0,0,.55); display:none; align-items:center; justify-content:center;
    padding:calc(12px + var(--s-top)) calc(12px + var(--s-right)) calc(12px + var(--s-bottom)) calc(12px + var(--s-left));
    z-index:50;
  }
  .modal.open{display:flex}
  .modal-card{
    width:min(100%, 980px); max-height:80dvh; background:#0f141b; border:1px solid var(--line); border-radius:16px; overflow:hidden;
    display:flex; flex-direction:column;
  }
  .modal-head{display:flex;align-items:center;justify-content:space-between;gap:8px;padding:12px 14px;background:#12161c;border-bottom:1px solid var(--line)}
  .modal-body{padding:10px;overflow:auto}
  .modal-actions{display:flex;gap:10px;padding:10px;border-top:1px solid var(--line)}
  .table{width:100%;border-collapse:collapse;table-layout:fixed}
  .table th,.table td{border-bottom:1px solid var(--line);padding:8px 10px;text-align:left;vertical-align:top}
  .table th{color:#c9d4df;font-size:13px;text-transform:uppercase;letter-spacing:.6px;position:sticky;top:0;background:#0f141b}
  .table td{font-size:14px}
  .nowrap{white-space:nowrap}
</style>

<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => navigator.serviceWorker.register('./service-worker.js'));
  }
</script>
</head>
<body>
  <header class="topbar">
    <div class="wrap">
      <h1>BOND HEAVY DUTY ‚Äî —Å–∏–ª–æ–≤—ã–µ –¥–Ω–∏</h1>
      <div class="sub">HIT: 1 —Ä–∞–∑–º–∏–Ω–æ—á–Ω—ã–π + 1 —Ä–∞–±–æ—á–∏–π —Å–µ—Ç –¥–æ –æ—Ç–∫–∞–∑–∞ ‚Ä¢ —Ç–µ–º–ø 4—Å –≤–≤–µ—Ä—Ö / 4—Å –≤–Ω–∏–∑ ‚Ä¢ –æ—Ñ–ª–∞–π–Ω + –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ</div>

      <div class="toolbar">
        <div><span class="muted">–î–∞—Ç–∞:</span> <input id="logDate" type="date" aria-label="–î–∞—Ç–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏"></div>

        <div class="btn" id="makeFromLastBtn" title="–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –¥–µ–Ω—å –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–æ—à–ª–æ–≥–æ">–ù–æ–≤—ã–π –¥–µ–Ω—å –∏–∑ –ø—Ä–æ—à–ª–æ–≥–æ</div>

        <div class="btn" id="exportBtn">–≠–∫—Å–ø–æ—Ä—Ç JSON</div>
        <label class="btn" aria-label="–ò–º–ø–æ—Ä—Ç JSON">
          –ò–º–ø–æ—Ä—Ç JSON
          <input id="importInput" type="file" accept="application/json" style="display:none">
        </label>

        <div class="btn" id="exportCsvBtn" title="CSV –∑–∞ –≤–µ—Å—å –ø–µ—Ä–∏–æ–¥">–≠–∫—Å–ø–æ—Ä—Ç CSV</div>
        <div class="btn" id="analyticsBtn" title="–ü–æ–∫–∞–∑–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É –ø—Ä–æ–≥—Ä–µ—Å—Å–∞">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</div>

        <div class="btn warn" id="copyDayBtn">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—à–ª—ã–µ –≤–µ—Å–∞</div>
        <div class="btn danger" id="resetBtn">–°–±—Ä–æ—Å —Ç–µ–∫—É—â–µ–≥–æ –¥–Ω—è</div>
        <div class="btn ok" onclick="window.print()">–ü–µ—á–∞—Ç—å</div>
      </div>

      <div class="tabs" role="tablist">
        <div class="tab active" data-day="upper" role="tab" aria-selected="true">–î–µ–Ω—å 1 ‚Äî –í–µ—Ä—Ö</div>
        <div class="tab" data-day="lower" role="tab" aria-selected="false">–î–µ–Ω—å 2 ‚Äî –ù–∏–∑ + –ö–æ—Ä</div>
      </div>
    </div>
  </header>

  <main>
    <!-- ===== –î–ï–ù–¨ 1 ===== -->
    <section id="upper" class="day active">
      <div class="block">
        <header>
          <div><strong>–í–µ—Ä—Ö —Ç–µ–ª–∞</strong> <span class="tag">HIT</span></div>
          <div class="muted">–û—Ç–¥—ã—Ö 60‚Äì120 —Å</div>
        </header>

        <div class="exercises">
          <div class="panel" data-ex="upper_press_incline">
            <div class="ex-title">1Ô∏è‚É£ –ñ–∏–º –≥–∞–Ω—Ç–µ–ª–µ–π –ø–æ–¥ —É–≥–ª–æ–º (15‚Äì30¬∞) <small>—Ü–µ–ª—å: 6‚Äì8 –¥–æ –æ—Ç–∫–∞–∑–∞</small></div>
            <div class="legend"><div>–°–µ—Ç</div><div>–í–µ—Å</div><div>–ü–æ–≤—Ç–æ—Ä—ã</div><div>–í—ã–ø.</div></div>
            <div class="set-row"><div class="set-name">–†–∞–∑–º–∏–Ω–∫–∞</div><input data-w type="number" step="0.5"><input data-r type="number" min="1" max="12"><label class="setchk"><input data-d type="checkbox"></label></div>
            <div class="set-row"><div class="set-name">–†–∞–±–æ—á–∏–π</div><input data-w type="number" step="0.5" value="20"><input data-r type="number" min="1" max="12" value="7"><label class="setchk"><input data-d type="checkbox"></label></div>
          </div>

          <div class="panel" data-ex="upper_latpull_pullups">
            <div class="ex-title">2Ô∏è‚É£ –¢—è–≥–∞ –≤–µ—Ä—Ö–Ω–µ–≥–æ –±–ª–æ–∫–∞ / –ø–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è <small>—Ü–µ–ª—å: 8‚Äì10</small></div>
            <div class="legend"><div>–°–µ—Ç</div><div>–í–µ—Å/–≤–∞—Ä–∏–∞–Ω—Ç</div><div>–ü–æ–≤—Ç–æ—Ä—ã</div><div>–í—ã–ø.</div></div>
            <div class="set-row"><div class="set-name">–†–∞–∑–º–∏–Ω–∫–∞</div><input data-w type="text" value="–±–ª–æ–∫ 30"><input data-r type="number" min="1" max="20" value="10"><label class="setchk"><input data-d type="checkbox"></label></div>
            <div class="set-row"><div class="set-name">–†–∞–±–æ—á–∏–π</div><input data-w type="text" value="–±–ª–æ–∫ 40 / –ø–æ–¥—Ç—è–≥. —Å–≤.–≤–µ—Å"><input data-r type="number" min="1" max="20" value="9"><label class="setchk"><input data-d type="checkbox"></label></div>
          </div>

          <div class="panel" data-ex="upper_chest_machine">
            <div class="ex-title">3Ô∏è‚É£ –ñ–∏–º —Ç—Ä–µ–Ω–∞–∂—ë—Ä (–≥—Ä—É–¥—å) <small>—Ü–µ–ª—å: 6‚Äì8</small></div>
            <div class="legend"><div>–°–µ—Ç</div><div>–í–µ—Å</div><div>–ü–æ–≤—Ç–æ—Ä—ã</div><div>–í—ã–ø.</div></div>
            <div class="set-row"><div class="set-name">–†–∞–∑–º–∏–Ω–∫–∞</div><input data-w type="number" step="5" value="55"><input data-r type="number" value="10"><label class="setchk"><input data-d type="checkbox"></label></div>
            <div class="set-row"><div class="set-name">–†–∞–±–æ—á–∏–π</div><input data-w type="number" step="5" value="65"><input data-r type="number" value="8"><label class="setchk"><input data-d type="checkbox"></label></div>
          </div>

          <div class="panel" data-ex="upper_row_cable">
            <div class="ex-title">4Ô∏è‚É£ –¢—è–≥–∞ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ —Ç—Ä–æ—Å–∞ <small>—Ü–µ–ª—å: 8‚Äì10</small></div>
            <div class="legend"><div>–°–µ—Ç</div><div>–í–µ—Å</div><div>–ü–æ–≤—Ç–æ—Ä—ã</div><div>–í—ã–ø.</div></div>
            <div class="set-row"><div class="set-name">–†–∞–∑–º–∏–Ω–∫–∞</div><input data-w type="number" step="5" value="45"><input data-r type="number" value="10"><label class="setchk"><input data-d type="checkbox"></label></div>
            <div class="set-row"><div class="set-name">–†–∞–±–æ—á–∏–π</div><input data-w type="number" step="5" value="55"><input data-r type="number" value="9"><label class="setchk"><input data-d type="checkbox"></label></div>
          </div>

          <div class="panel" data-ex="upper_shoulder_dbpress">
            <div class="ex-title">5Ô∏è‚É£ –ê—Ä–º–µ–π—Å–∫–∏–π –∂–∏–º –≥–∞–Ω—Ç–µ–ª–µ–π <small>—Ü–µ–ª—å: 6‚Äì8</small></div>
            <div class="legend"><div>–°–µ—Ç</div><div>–í–µ—Å</div><div>–ü–æ–≤—Ç–æ—Ä—ã</div><div>–í—ã–ø.</div></div>
            <div class="set-row"><div class="set-name">–†–∞–∑–º–∏–Ω–∫–∞</div><input data-w type="number" step="0.5" value="12.5"><input data-r type="number" value="8"><label class="setchk"><input data-d type="checkbox"></label></div>
            <div class="set-row"><div class="set-name">–†–∞–±–æ—á–∏–π</div><input data-w type="number" step="0.5" value="15"><input data-r type="number" value="8"><label class="setchk"><input data-d type="checkbox"></label></div>
          </div>

          <div class="panel" data-ex="upper_triceps_rope">
            <div class="ex-title">6Ô∏è‚É£ –¢—Ä–∏—Ü–µ–ø—Å —Ç—Ä–æ—Å (–≤–µ—Ä—ë–≤–∫–∞) <small>—Ü–µ–ª—å: 10‚Äì12</small></div>
            <div class="legend"><div>–°–µ—Ç</div><div>–í–µ—Å</div><div>–ü–æ–≤—Ç–æ—Ä—ã</div><div>–í—ã–ø.</div></div>
            <div class="set-row"><div class="set-name">–†–∞–∑–º–∏–Ω–∫–∞</div><input data-w type="number" step="2.5" value="20"><input data-r type="number" value="10"><label class="setchk"><input data-d type="checkbox"></label></div>
            <div class="set-row"><div class="set-name">–†–∞–±–æ—á–∏–π</div><input data-w type="number" step="2.5" value="25"><input data-r type="number" value="11"><label class="setchk"><input data-d type="checkbox"></label></div>
          </div>

          <div class="panel" data-ex="upper_biceps_bar">
            <div class="ex-title">7Ô∏è‚É£ –ë–∏—Ü–µ–ø—Å —à—Ç–∞–Ω–≥–∞ (EZ) <small>—Ü–µ–ª—å: 8‚Äì10</small></div>
            <div class="legend"><div>–°–µ—Ç</div><div>–í–µ—Å</div><div>–ü–æ–≤—Ç–æ—Ä—ã</div><div>–í—ã–ø.</div></div>
            <div class="set-row"><div class="set-name">–†–∞–∑–º–∏–Ω–∫–∞</div><input data-w type="number" step="2.5" value="15"><input data-r type="number" value="8"><label class="setchk"><input data-d type="checkbox"></label></div>
            <div class="set-row"><div class="set-name">–†–∞–±–æ—á–∏–π</div><input data-w type="number" step="2.5" value="20"><input data-r type="number" value="8"><label class="setchk"><input data-d type="checkbox"></label></div>
          </div>
        </div>

        <div class="sumline">
          <span>üíæ –û—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º –∏ –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ</span>
          <span id="upperDone" class="tag">–í—ã–ø–æ–ª–Ω–µ–Ω–æ: 0 —Å–µ—Ç–æ–≤</span>
        </div>
      </div>
    </section>

    <!-- ===== –î–ï–ù–¨ 2 ===== -->
    <section id="lower" class="day">
      <div class="block">
        <header>
          <div><strong>–ù–∏–∑ + –∫–æ—Ä–ø—É—Å</strong> <span class="tag">HIT</span></div>
          <div class="muted">–û—Ç–¥—ã—Ö 90‚Äì120 —Å</div>
        </header>

        <div class="exercises">
          <div class="panel" data-ex="lower_squat_legpress">
            <div class="ex-title">1Ô∏è‚É£ –ü—Ä–∏—Å–µ–¥ —Å–æ —à—Ç–∞–Ω–≥–æ–π / –∂–∏–º –Ω–æ–≥–∞–º–∏ <small>—Ü–µ–ª—å: 8‚Äì10</small></div>
            <div class="legend"><div>–°–µ—Ç</div><div>–í–µ—Å</div><div>–ü–æ–≤—Ç–æ—Ä—ã</div><div>–í—ã–ø.</div></div>
            <div class="set-row"><div class="set-name">–†–∞–∑–º–∏–Ω–∫–∞</div><input data-w type="number" step="2.5" value="30"><input data-r type="number" value="10"><label class="setchk"><input data-d type="checkbox"></label></div>
            <div class="set-row"><div class="set-name">–†–∞–±–æ—á–∏–π</div><input data-w type="number" step="2.5" value="40"><input data-r type="number" value="10"><label class="setchk"><input data-d type="checkbox"></label></div>
          </div>

          <div class="panel" data-ex="lower_rdl">
            <div class="ex-title">2Ô∏è‚É£ –†—É–º—ã–Ω—Å–∫–∞—è —Ç—è–≥–∞ <small>—Ü–µ–ª—å: 8</small></div>
            <div class="legend"><div>–°–µ—Ç</div><div>–í–µ—Å</div><div>–ü–æ–≤—Ç–æ—Ä—ã</div><div>–í—ã–ø.</div></div>
            <div class="set-row"><div class="set-name">–†–∞–∑–º–∏–Ω–∫–∞</div><input data-w type="number" step="2.5" value="25"><input data-r type="number" value="8"><label class="setchk"><input data-d type="checkbox"></label></div>
            <div class="set-row"><div class="set-name">–†–∞–±–æ—á–∏–π</div><input data-w type="number" step="2.5" value="35"><input data-r type="number" value="8"><label class="setchk"><input data-d type="checkbox"></label></div>
          </div>

          <div class="panel" data-ex="lower_calves">
            <div class="ex-title">3Ô∏è‚É£ –ü–æ–¥—ä—ë–º –Ω–∞ –Ω–æ—Å–∫–∏ (–∏–∫—Ä—ã) <small>—Ü–µ–ª—å: 15‚Äì20</small></div>
            <div class="legend"><div>–°–µ—Ç</div><div>–í–µ—Å</div><div>–ü–æ–≤—Ç–æ—Ä—ã</div><div>–í—ã–ø.</div></div>
            <div class="set-row"><div class="set-name">–†–∞–∑–º–∏–Ω–∫–∞</div><input data-w type="number" step="2.5" value="20"><input data-r type="number" value="12"><label class="setchk"><input data-d type="checkbox"></label></div>
            <div class="set-row"><div class="set-name">–†–∞–±–æ—á–∏–π</div><input data-w type="number" step="2.5" value="30"><input data-r type="number" value="16"><label class="setchk"><input data-d type="checkbox"></label></div>
          </div>

          <div class="panel" data-ex="lower_core_plank">
            <div class="ex-title">4Ô∏è‚É£ –ö–æ—Ä: –ø–ª–∞–Ω–∫–∞ + –≤–∞–∫—É—É–º</div>
            <div class="legend"><div>–°–µ—Ç</div><div>–í–µ—Å/—Å–µ–∫</div><div>–ü–æ–≤—Ç–æ—Ä—ã/—Å–µ–∫</div><div>–í—ã–ø.</div></div>
            <div class="set-row"><div class="set-name">–ü–ª–∞–Ω–∫–∞</div><input data-w type="text" value="—Å–≤. –≤–µ—Å"><input data-r type="text" value="45 —Å–µ–∫"><label class="setchk"><input data-d type="checkbox"></label></div>
            <div class="set-row"><div class="set-name">–í–∞–∫—É—É–º</div><input data-w type="text" value="–¥—ã—Ö–∞–Ω–∏–µ"><input data-r type="text" value="3√ó10 —Å–µ–∫"><label class="setchk"><input data-d type="checkbox"></label></div>
          </div>
        </div>

        <div class="sumline">
          <span>üíæ –û—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º –∏ –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ</span>
          <span id="lowerDone" class="tag">–í—ã–ø–æ–ª–Ω–µ–Ω–æ: 0 —Å–µ—Ç–æ–≤</span>
        </div>
      </div>
    </section>
  </main>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ -->
  <div class="modal" id="analyticsModal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="anTitle">
      <div class="modal-head">
        <strong id="anTitle">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</strong>
        <div class="muted">–≤—Å–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –¥–Ω–∏</div>
      </div>
      <div class="modal-body">
        <div id="analyticsTableWrap"></div>
      </div>
      <div class="modal-actions">
        <div class="btn" id="downloadCsvBtn">–°–∫–∞—á–∞—Ç—å CSV</div>
        <div class="btn ghost" id="closeAnalyticsBtn">–ó–∞–∫—Ä—ã—Ç—å</div>
      </div>
    </div>
  </div>

  <footer>
    –¢–µ–º–ø: 4—Å –≤–≤–µ—Ä—Ö / 4—Å –≤–Ω–∏–∑ ‚Ä¢ –î–æ—Å—Ç–∏–≥ –≤–µ—Ä—Ö–Ω–µ–π –≥—Ä–∞–Ω–∏—Ü—ã –ø–æ–≤—Ç–æ—Ä–æ–≤ ‚Üí —É–≤–µ–ª–∏—á—å –≤–µ—Å –≤ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑
  </footer>

<script>
(function(){
  const VERSION = 'v7'; // –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è; —ç–∫—Å–ø–æ—Ä—Ç —Å–æ–±–∏—Ä–∞–µ—Ç –í–°–ï –≤–µ—Ä—Å–∏–∏ bondHD.*
  const tabs = document.querySelectorAll('.tab');
  const days = document.querySelectorAll('.day');
  const logDate = document.getElementById('logDate');
  const exportBtn = document.getElementById('exportBtn');
  const importInput = document.getElementById('importInput');
  const resetBtn = document.getElementById('resetBtn');
  const copyDayBtn = document.getElementById('copyDayBtn');
  const makeFromLastBtn = document.getElementById('makeFromLastBtn');
  const exportCsvBtn = document.getElementById('exportCsvBtn');
  const analyticsBtn = document.getElementById('analyticsBtn');

  const analyticsModal = document.getElementById('analyticsModal');
  const analyticsWrap  = document.getElementById('analyticsTableWrap');
  const closeAnalyticsBtn = document.getElementById('closeAnalyticsBtn');
  const downloadCsvBtn = document.getElementById('downloadCsvBtn');

  function activeDayId(){ return document.querySelector('.tab.active').dataset.day }
  function storeKey(day, date){ return `bondHD.${VERSION}.${day}.${date}` }
  function lastKey(day){ return `bondHD.${VERSION}.${day}.LAST` }
  function todayISO(){
    const d = new Date(); const off = d.getTimezoneOffset();
    return new Date(d.getTime()-off*60000).toISOString().slice(0,10);
  }
  logDate.value = todayISO();

  // ---- –≤–∫–ª–∞–¥–∫–∏
  tabs.forEach(t=>{
    t.addEventListener('click', ()=>{
      tabs.forEach(x=>{x.classList.remove('active'); x.setAttribute('aria-selected','false')});
      t.classList.add('active'); t.setAttribute('aria-selected','true');
      days.forEach(d=>d.classList.remove('active'));
      document.getElementById(t.dataset.day).classList.add('active');
      loadForDate({fallbackToLast:false});
      updateCounters();
    });
  });

  // ---- —Ñ–æ—Ä–º–∞
  function readForm(day){
    const root = document.getElementById(day);
    const panels = root.querySelectorAll('.panel[data-ex]');
    const data = {};
    panels.forEach(p=>{
      const ex = p.getAttribute('data-ex');
      const rows = p.querySelectorAll('.set-row');
      data[ex] = [];
      rows.forEach(r=>{
        data[ex].push({
          set: r.querySelector('.set-name')?.textContent.trim() ?? '',
          weight: r.querySelector('[data-w]')?.value ?? '',
          reps: r.querySelector('[data-r]')?.value ?? '',
          done: !!r.querySelector('[data-d]')?.checked
        });
      });
    });
    return data;
  }

  function writeForm(day, data){
    if(!data) return;
    const root = document.getElementById(day);
    const panels = root.querySelectorAll('.panel[data-ex]');
    panels.forEach(p=>{
      const ex = p.getAttribute('data-ex');
      const rows = p.querySelectorAll('.set-row');
      const arr = data[ex] || [];
      rows.forEach((r,i)=>{
        const item = arr[i]; if(!item) return;
        const w = r.querySelector('[data-w]'); if(w) w.value = item.weight ?? '';
        const rr = r.querySelector('[data-r]'); if(rr) rr.value = item.reps ?? '';
        const ch = r.querySelector('[data-d]'); if(ch) ch.checked = !!item.done;
      });
    });
  }

  function clearForm(day){
    const root = document.getElementById(day);
    root.querySelectorAll('[data-w]').forEach(i=>i.value='');
    root.querySelectorAll('[data-r]').forEach(i=>i.value='');
    root.querySelectorAll('[data-d]').forEach(c=>c.checked=false);
  }

  function saveForDate(){
    const day = activeDayId();
    const date = logDate.value || todayISO();
    const data = readForm(day);
    localStorage.setItem(storeKey(day,date), JSON.stringify(data));
    localStorage.setItem(lastKey(day), JSON.stringify(data));
    updateCounters();
  }

  function loadForDate({fallbackToLast} = {fallbackToLast:false}){
    const day = activeDayId();
    const date = logDate.value || todayISO();
    const raw = localStorage.getItem(storeKey(day,date));
    if(raw){ writeForm(day, JSON.parse(raw)); return; }
    if(fallbackToLast){
      const last = localStorage.getItem(lastKey(day));
      if(last){
        const data = JSON.parse(last);
        Object.keys(data).forEach(ex=>data[ex].forEach(s=>s.done=false));
        writeForm(day,data); return;
      }
    }
    clearForm(day);
  }

  document.body.addEventListener('input', e=>{
    if(e.target.matches('[data-w], [data-r]')) saveForDate();
  });
  document.body.addEventListener('change', e=>{
    if(e.target.matches('input[type="date"]')) { loadForDate({fallbackToLast:false}); updateCounters(); return; }
    if(e.target.matches('[data-d]')) saveForDate();
  });

  // ---- –∫–Ω–æ–ø–∫–∞: –ù–æ–≤—ã–π –¥–µ–Ω—å –∏–∑ –ø—Ä–æ—à–ª–æ–≥–æ (—è–≤–Ω–æ)
  makeFromLastBtn.addEventListener('click', ()=>{
    const day = activeDayId();
    const last = localStorage.getItem(lastKey(day));
    if(!last){ alert('–ù–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –¥–Ω—è –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è. –ó–∞–ø–æ–ª–Ω–∏ –ª—é–±–æ–π –¥–µ–Ω—å –∏ –æ–Ω —Å—Ç–∞–Ω–µ—Ç —à–∞–±–ª–æ–Ω–æ–º.'); return; }
    const data = JSON.parse(last);
    Object.keys(data).forEach(ex=>data[ex].forEach(s=>s.done=false)); // —á–µ–∫–±–æ–∫—Å—ã —á–∏—Å—Ç–∏–º
    writeForm(day, data);
    saveForDate(); // —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–¥ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç–æ–π
  });

  // ---- —ç–∫—Å–ø–æ—Ä—Ç JSON
  exportBtn.addEventListener('click', ()=>{
    const all = {};
    for(let i=0;i<localStorage.length;i++){
      const k = localStorage.key(i);
      if(k && k.startsWith('bondHD.')) all[k] = localStorage.getItem(k);
    }
    const blob = new Blob([JSON.stringify(all,null,2)], {type:'application/json'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `bond_hd_export_${todayISO()}.json`;
    a.click(); URL.revokeObjectURL(a.href);
  });

  // ---- –∏–º–ø–æ—Ä—Ç JSON
  importInput.addEventListener('change', async (e)=>{
    const file = e.target.files[0]; if(!file) return;
    const text = await file.text(); const obj = JSON.parse(text);
    Object.keys(obj).forEach(k=>{ if(k.startsWith('bondHD.')) localStorage.setItem(k, obj[k]); });
    loadForDate({fallbackToLast:false}); updateCounters(); importInput.value='';
  });

  // ---- –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—à–ª—ã–µ –≤–µ—Å–∞ (–ø–æ –¥–∞—Ç–µ)
  copyDayBtn.addEventListener('click', ()=>{
    const day = activeDayId(); const date = logDate.value || todayISO();
    const keys = [];
    for(let i=0;i<localStorage.length;i++){
      const k = localStorage.key(i);
      if(k && k.startsWith('bondHD.') && k.includes(`.${day}.`) && /\d{4}-\d{2}-\d{2}$/.test(k)) keys.push(k);
    }
    const prev = keys.filter(k=>k.split('.').pop() < date).sort().pop();
    if(prev){
      const data = JSON.parse(localStorage.getItem(prev));
      Object.keys(data).forEach(ex=>data[ex].forEach(s=>s.done=false));
      writeForm(day,data); saveForDate();
    } else {
      alert('–ù–µ—Ç –±–æ–ª–µ–µ —Ä–∞–Ω–Ω–µ–≥–æ –¥–Ω—è –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è.');
    }
  });

  // ---- –≠–∫—Å–ø–æ—Ä—Ç CSV + –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
  function collectAllRows(){
    const rows = [];
    for(let i=0;i<localStorage.length;i++){
      const key = localStorage.key(i);
      if(!key || !key.startsWith('bondHD.')) continue;
      if(key.endsWith('.LAST')) continue;
      // —Ñ–æ—Ä–º–∞—Ç: bondHD.{ver}.{day}.{YYYY-MM-DD}
      const parts = key.split('.');
      const day = parts[2]; const date = parts[3];
      if(!/\d{4}-\d{2}-\d{2}/.test(date)) continue;

      try{
        const data = JSON.parse(localStorage.getItem(key) || '{}');
        Object.entries(data).forEach(([exercise, sets])=>{
          (sets||[]).forEach(s=>{
            rows.push({
              date, day,
              exercise,
              set: s.set ?? '',
              weight: (s.weight ?? '').toString().replace(/\s+/g,' ').trim(),
              reps: (s.reps ?? '').toString().replace(/\s+/g,' ').trim(),
              done: s.done ? 1 : 0
            });
          });
        });
      }catch(e){}
    }
    // —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ –∏ –¥–Ω—é
    rows.sort((a,b)=> (a.date+b.day).localeCompare(b.date+b.day));
    return rows;
  }

  function toCsv(rows){
    const head = ['date','day','exercise','set','weight','reps','done'];
    const escape = v => `"${String(v).replaceAll(`"`,`""`)}"`;
    const body = rows.map(r => head.map(h => escape(r[h]??'')).join(',')).join('\n');
    return head.join(',') + '\n' + body;
  }

  exportCsvBtn.addEventListener('click', ()=>{
    const rows = collectAllRows();
    if(!rows.length){ alert('–ü–æ–∫–∞ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.'); return; }
    const csv = toCsv(rows);
    const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `bond_hd_history_${todayISO()}.csv`;
    a.click(); URL.revokeObjectURL(a.href);
  });

  analyticsBtn.addEventListener('click', ()=>{
    const rows = collectAllRows();
    const wrap = document.createElement('div');
    const table = document.createElement('table');
    table.className = 'table';
    table.innerHTML =
      `<thead><tr>
        <th class="nowrap">–î–∞—Ç–∞</th><th class="nowrap">–î–µ–Ω—å</th><th>–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</th>
        <th>–°–µ—Ç</th><th class="nowrap">–í–µ—Å</th><th class="nowrap">–ü–æ–≤—Ç.</th><th class="nowrap">–í—ã–ø.</th>
      </tr></thead><tbody></tbody>`;
    const tb = table.querySelector('tbody');

    rows.forEach(r=>{
      const tr = document.createElement('tr');
      tr.innerHTML =
        `<td class="nowrap">${r.date}</td>
         <td class="nowrap">${r.day==='upper'?'–í–µ—Ä—Ö':'–ù–∏–∑'}</td>
         <td>${r.exercise}</td>
         <td>${r.set}</td>
         <td class="nowrap">${r.weight}</td>
         <td class="nowrap">${r.reps}</td>
         <td class="nowrap">${r.done}</td>`;
      tb.appendChild(tr);
    });

    if(!rows.length){
      const tr = document.createElement('tr');
      tr.innerHTML = `<td colspan="7" class="muted">–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π</td>`;
      tb.appendChild(tr);
    }

    wrap.appendChild(table);
    analyticsWrap.innerHTML = '';
    analyticsWrap.appendChild(wrap);
    analyticsModal.classList.add('open');
    analyticsModal.setAttribute('aria-hidden','false');
  });

  closeAnalyticsBtn.addEventListener('click', ()=>{
    analyticsModal.classList.remove('open');
    analyticsModal.setAttribute('aria-hidden','true');
  });

  downloadCsvBtn.addEventListener('click', ()=>{
    const rows = collectAllRows();
    if(!rows.length){ alert('–ü–æ–∫–∞ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤—ã–≥—Ä—É–∑–∫–∏.'); return; }
    const csv = toCsv(rows);
    const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `bond_hd_history_${todayISO()}.csv`;
    a.click(); URL.revokeObjectURL(a.href);
  });

  resetBtn.addEventListener('click', ()=>{
    clearForm(activeDayId());
    saveForDate();
  });

  function updateCounters(){
    ['upper','lower'].forEach(id=>{
      const root = document.getElementById(id);
      const chk = root.querySelectorAll('[data-d]');
      let done = 0; chk.forEach(c=>{ if(c.checked) done++; });
      const el = document.getElementById(id==='upper' ? 'upperDone' : 'lowerDone');
      if(el){ el.textContent = `–í—ã–ø–æ–ª–Ω–µ–Ω–æ: ${done} —Å–µ—Ç–æ–≤`; el.className = 'tag ' + (done>0?'oktag':''); }
    });
  }

  // –ø–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
  loadForDate({fallbackToLast:true});
  updateCounters();
})();
</script>
</body>
</html>
